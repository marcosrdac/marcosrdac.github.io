<!doctype html>
<html>

  <head>
    <meta charset="utf-8">
    <!--<meta name="viewport"     content="width=device-width, initial-scale=1.0">-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
    <meta name="author"       content="Marcos Reinan de Assis Conceição">
    <meta name="Description"  content="">
    <title>Marcos Conceição</title>
    <!-- CSS -->
    <link href="../../style/style.css" rel="stylesheet" media="screen, projection">
    <!-- Scripts -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>


  <body>

    <header class="site-header">
    <a href="../../index.html"><h1>Marcos</h1><h1>Conceição</h1></a>
    </header>


    <nav>
      <ul>
        <li><a href="../../content/portfolio.html">portefólio</a></li>
        <li><a href="../../content/services.html">serviços_oferecidos</a></li>
        <li><a href="../../content/contact.html">contato</a></li>
        <li><a href="../../content/about.html">sobre</a></li>
        <li><a href="../../content/blog.html">blog</a></li>
      </ul>
    </nav>


    <div class="page-container">
      <main>
        <header class="page-header">blog</header>

<article>
<header>
<h1><a id='post_title' href='20200803_metaprogramming_in_julia.html'>20200803 3 functions, 1 easy block of code</a></h1>
<p>a little of metaprogramming in julia</p>
</header>
<p>Have you ever needed to create three very similar functions? Today I&#8217;m showing you how to do that thing that you always wanted to do, in three minutes, using pure julia. I think I don&#8217;t even need to explain it for you to get what&#8217;s going on!</p>

<p>Supose you want to create three functions in julia: \(f(x)=x\), \(g(x)=x^2\) and \(h(x)=x^3\). So you could workfully write:</p>

<div class="codehilite"><pre><span></span><code><span class="k">function</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">x</span>
<span class="k">end</span>

<span class="k">function</span> <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">x</span><span class="o">^</span><span class="mi">2</span>
<span class="k">end</span>

<span class="k">function</span> <span class="n">h</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">x</span><span class="o">^</span><span class="mi">3</span>
<span class="k">end</span>
</code></pre></div>

<p>But I know, when you were about to write &#8220;function&#8221; for the seccond time, you were already be thinking, &#8220;man, there must be a way for me to do it faster&#8230;&#8221;. <strong>And you would be right!</strong> Lets expand our objectives for 6 functions and do it without all this machine work!</p>

<div class="codehilite"><pre><span></span><code><span class="k">for</span> <span class="n">func</span> <span class="kp">in</span> <span class="p">(</span><span class="o">:</span><span class="n">f</span><span class="p">,</span> <span class="o">:</span><span class="n">g</span><span class="p">,</span> <span class="o">:</span><span class="n">h</span><span class="p">,</span> <span class="o">:</span><span class="n">i</span><span class="p">,</span> <span class="o">:</span><span class="n">j</span><span class="p">,</span> <span class="o">:</span><span class="n">k</span><span class="p">)</span>

  <span class="k">if</span>     <span class="n">func</span> <span class="o">==</span> <span class="o">:</span><span class="n">f</span>  <span class="n">E</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="k">elseif</span> <span class="n">func</span> <span class="o">==</span> <span class="o">:</span><span class="n">g</span>  <span class="n">E</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="k">elseif</span> <span class="n">func</span> <span class="o">==</span> <span class="o">:</span><span class="n">h</span>  <span class="n">E</span> <span class="o">=</span> <span class="mi">3</span>
  <span class="k">elseif</span> <span class="n">func</span> <span class="o">==</span> <span class="o">:</span><span class="n">i</span>  <span class="n">E</span> <span class="o">=</span> <span class="mi">4</span>
  <span class="k">elseif</span> <span class="n">func</span> <span class="o">==</span> <span class="o">:</span><span class="n">j</span>  <span class="n">E</span> <span class="o">=</span> <span class="mi">5</span>
  <span class="k">elseif</span> <span class="n">func</span> <span class="o">==</span> <span class="o">:</span><span class="n">k</span>  <span class="n">E</span> <span class="o">=</span> <span class="mi">6</span>
  <span class="k">end</span>

  <span class="k">quote</span>
    <span class="k">function</span> <span class="o">$</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">x</span><span class="o">^$</span><span class="n">E</span>
    <span class="k">end</span>
  <span class="k">end</span> <span class="o">|&gt;</span> <span class="n">eval</span>

<span class="k">end</span>
</code></pre></div>

<p>And you can then start using \(k(x)\) to get \(x^6\).</p>

<h1>The downside</h1>

<p>Although you might think that your code would then be slower at runtime, after all it&#8217;s all super high level, it will not. These definitions are run at parse time, before actual compilation. So, roughly speaking, the only downside is that compiling your code is going to take more time.</p>

<h1>For those who want to understand what&#8217;s going on&#8230;</h1>

<ul>
<li>we enter a loop block at line 1. One iteration is done for each of the symbols f, g, h, i, j, k. At each iteration, func is assigned to one of them.</li>
<li>then we enter the <code>if elseif</code> block. Depending on the symbol we are working on, we define a constant value E, the exponent used in the function.</li>
<li>the next block <code>quote</code>s the code that we actually want to run: the function definition. We make use of the symbols previously defined by interpolating their values. For that we make use of the \$ operator.</li>
<li>the end: all inside this quotation returns a block object and, by itself, does nothing. It only becomes code when put this result inside the <code>eval</code> function. I could indeed be done like this:</li>
</ul>

<div class="codehilite"><pre><span></span><code><span class="n">eval</span><span class="p">(</span>
  <span class="k">quote</span>
    <span class="k">function</span> <span class="o">$</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">x</span><span class="o">^$</span><span class="n">E</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="p">)</span>
</code></pre></div>

<p>but I think it&#8217;s prettier to pipe the quotation end to the eval function with <code>|&gt; eval</code>.</p>

</article>
      </main>

      <aside>
        <header class="page-header">author</header>
        <figure>
          <img id=author src="../../pictures/me.gif" title="me" alt="photo of me" width="100%">
          <figcaption>marcosrdac</figcaption>
        </figure>
        <p>Marcos Conceição.</p>
        <p>Apaixonado por Linux, machine learning e obras do David Lynch.</p>
        <p>Graduando em Geofísica pela UFBa.</p>
        <p>Técnico em Edificações pelo IFBa.</p>
      </aside>
    </div>


    <footer>
      <figure>
        <img src="../../pictures/footer_sky.gif" title="footer" alt="">
      </figure>
      <p>Marcos Conceição, 2019.</p>
    </footer>

  </body>
</html>
